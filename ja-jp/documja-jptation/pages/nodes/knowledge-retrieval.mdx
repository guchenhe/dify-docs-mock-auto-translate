```mdx
---
title: "知識検索"
description: "Search knowledge bases for relevant information"
icon: "database"
---

知識检索ノードは、知識ベースから関連情報を検索し、下流ノードで使用するためのコンテキストコンテンツを返します。これは、文書からの特定の情報を提供することによって、RAG（检索增强生成）アプリケーションを可能にします。

<Frame caption="知識検索ノードの設定">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/d90961c6d794d425a8e11df177315188.png" alt="知識検索ノードインターフェース" />
</Frame>

<Info>
  このノードを使用する前に知識ベースを作成して入力してください。セットアップ手順については、[知識ベース作成ガイド](/en/guides/knowledge-base/create-knowledge-and-upload-documents)を参照してください。
</Info>

## 設定

### クエリと知識ベースの選択

**Query**は、知識ベースで何を検索するかを決定します。チャットフローアプリケーションでのユーザー入力には `sys.query` を使用するか、ワークフローから任意のテキスト変数を使用してください。クエリは200文字に制限されています。

検索する1つ以上の**知識ベース**を選択します。それぞれには、Difyにアップロードしたインデックス付き文書が含まれています。異なる戦略を使用して、複数の知識ベースを同時に検索できます。

### 検索戦略

コンテンツをどのように検索するかを選択します：

<Tabs>
  <Tab title="セマンティック検索">
    ベクトル埋め込みを使用して、意味に基づいた概念的に類似したコンテンツを見つけます。自然言語クエリや異なる用語を使った関連概念に適しています。
  </Tab>
  
  <Tab title="キーワード検索">
    特定の単語の正確な一致を対象とする従来の全文検索。特定の用語、コード、または名前に対しては迅速かつ予測可能です。
  </Tab>
  
  <Tab title="ハイブリッド検索">
    セマンティックアプローチとキーワードアプローチを組み合わせます。結果は、特別なモデルを使用して再ランキングされ、より関連性の高いものになります。
  </Tab>
</Tabs>

## 高度な設定

<Frame caption="高度な検索設定オプション">
  <img src="https://assets-docs.dify.ai/2025/03/fbd43d558f83b355a1b18ac26a253b84.png" alt="知識検索設定インターフェース" />
</Frame>

### 検索パラメータ

**Top K**は、検索する文書チャンクの数を制御します。焦点を絞った結果には3〜5チャンク、包括的なカバレッジには10〜15チャンクから始めてください。

**スコア閾値**は最低類似度スコアを設定します。より高い閾値（0.7以上）は関連性を保証し、低い閾値（0.5以下）はより多くの関連性の低いコンテンツを含みます。

**再ランキング**は、初期検索後に結果を再スコアリングします。ハイブリッド検索、多くのチャンク、または速度よりも精度が重要な場合に有効にします。

### メタデータフィルタリング

文書のタイプ、日付、部門などのメタデータを使用して結果をフィルタリングします。大規模な知識ベースでのターゲット検索を可能にするために、文書をアップロードする際にメタデータを設定してください。

### 複数知識ベース戦略

**N対1リコール**は、クエリを分析し、適切な知識ベースを選択して検索を最適化するために関数呼び出しを使用します。異なるドメインの専門知識ベースに最適です。

**多方向リコール**は、選択したすべての知識ベースを同時にクエリし、結果を組み合わせます。情報が複数のソースにまたがる場合や総合的なカバレッジを必要とする場合に使用します。

<Frame caption="複数知識ベースの検索戦略の比較">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/4a3007cda9dfa50ddac3711693725dce.png" alt="検索モードの比較" />
</Frame>

## 出力と統合

ノードはテキストコンテンツとメタデータ（ソース、スコア、ドキュメントID）を含む取得された文書チャンクの配列を出力します。この構造化された出力は、引用に必要な情報を保持します。

### RAG統合

知識検索の出力をLLMノードのコンテキスト入力に接続してRAGアプリケーションに使用します。検索結果をコンテキスト変数として使用する場合、Difyはソースを自動的に追跡し、引用を可能にします。

```text
System: 提供されたコンテキストに基づいて回答してください。
Context: {{knowledge_retrieval.result}}
User: {{user_question}}
```

### レート制限

知識検索操作は、サブスクリプションプランに基づいてレート制限が課されます。システムは、リクエストを60秒のスライディングウィンドウを使用してRedisで追跡します。制限を超えると、`RateLimitExceeded`エラーが返されます。

### パフォーマンスの考慮事項

検索の質はインデックス作成の方法に依存します。小さいチャンク（200-500トークン）は正確な検索を可能にし、大きいチャンク（800-1500トークン）はコンテキストを維持します。知識ベースにはレート制限があります - ノードはスロットリングを処理し、同一クエリを自動的にキャッシュします。
```