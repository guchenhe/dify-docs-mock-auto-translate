---
title: "MCPツールの使用"
icon: "microchip"
---

[MCPサーバー](https://modelcontextprotocol.io/introduction)から外部ツールをDifyアプリに接続します。組み込みツールだけでなく、成長する[MCPエコシステム](https://mcpservers.org/)のツールを使用できます。

<Note>
  これはDifyでMCPツールを使用することについて説明しています。DifyアプリをMCPサーバーとして公開するには、[こちら](/en/guides/application-publishing/publish-mcp)を参照してください。
</Note>

<Info>
  現在は[HTTPトランスポート](https://modelcontextprotocol.io/docs/concepts/architecture#transport-layer)を持つMCPサーバーのみサポートしています。
</Info>

## MCPサーバーの追加

ワークスペースで**ツール** → **MCP**に移動します。

![](/images/6cef1436fcc13a65ccedb54bcf5ab77eb87b8faba1098a85951839fb1907f2d2.png)

**MCPサーバーを追加（HTTP）**をクリック：

![](/images/b5429131836c1caae84f4ce8b3b806221e39636723644961ce2f2a97d5421f16.png)

**サーバーURL**: MCPサーバーの場所（例：`https://api.notion.com/mcp`）

**名前とアイコン**: 有用な名前を付けてください。Difyは自動的にアイコンを取得しようとします。

**サーバーID**: 一意の識別子（小文字、数字、アンダースコア、ハイフン、最大24文字）

<Warning>
  使用を開始したら、サーバーIDを変更しないでください。このサーバーのツールを使用するアプリが壊れます。
</Warning>

## 次に何が起こるか

Difyが自動的に：
1. サーバーに接続
2. OAuth関連の処理を実行
3. 利用可能なツールのリストを取得
4. アプリビルダーで使用できるように設定

ツールが見つかるとサーバーカードが表示されます：

![](/images/fcef5ecad1deca82a1d8988c4bcb7cec745a0cd47945ff05fca588502cfaafbc.png)

## サーバーの管理

任意のサーバーカードをクリックして：

**ツールを更新**: 外部サービスが新しいツールを追加したときに更新

![](/images/7b526a64ff34b10a357511b2cd3e42f251a6786210eac71c58ca7bfccdf63f0c.png)

**再認証**: トークンが期限切れになったときに認証を修正

**設定を編集**: サーバーの詳細を変更（ただしIDは除く！）

**削除**: サーバーを切断（そのツールを使用するアプリが壊れます）

## MCPツールの使用

接続されると、MCPツールは期待される場所すべてに表示されます：

**エージェント内**: ツールはサーバーごとにグループ化されて表示（「Notion MCP » ページを作成」）

**ワークフロー内**: MCPツールがノードとして利用可能

**エージェントノード内**: 通常のエージェントと同様

## ツールのカスタマイズ

MCPツールを追加するときにカスタマイズできます：

![](/images/CleanShot2025-07-07at07.41.33@2x.png)

**説明**: デフォルトの説明をより具体的なものにオーバーライド

**パラメータ**: 各ツールパラメータに対して選択：
- **自動**: AIに値を決定させる
- **固定**: 変更されない特定の値を設定

**例**: 検索ツールの場合、`numResults`を5（ままにします。

## アプリの共有

MCPツールを使用するアプリをエクスポートするとき：
- エクスポートにはサーバーIDが含まれます
- 他の場所でアプリを使用するには、同じIDで同じサーバーを追加
- アプリが必要とするMCPサーバーを文書化

## トラブルシューティング

**「未設定サーバー」**: URLを確認して再認証

**ツールが見つからない**: 「ツールを更新」をクリック

**アプリが壊れた**: おそらくサーバーIDを変更しました。元のIDで再度追加してください。

## ヒント

- `github-prod`や`crm-system`のような永続的で説明的なサーバーIDを使用
- 開発/ステージング/本番環境で同じMCP設定を維持
- 設定項目には固定値を、動的入力には自動を設定
- デプロイ前にMCPインテグレーションをテスト