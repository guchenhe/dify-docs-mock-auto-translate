```mdx
---
title: "知识检索"
description: "Search knowledge bases for relevant information"
icon: "database"
---

知识检索节点在您的知识库中搜索相关信息，并返回上下文内容以供下游节点使用。通过提供文档中的特定信息，它支持检索增强生成 (RAG) 应用。

<Frame caption="知识检索节点配置">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/d90961c6d794d425a8e11df177315188.png" alt="Knowledge Retrieval Node Interface" />
</Frame>

<Info>
  在使用此节点之前，请创建并填充知识库。有关设置说明，请参阅[知识库创建指南](/en/guides/knowledge-base/create-knowledge-and-upload-documents)。
</Info>

## 配置

### 查询和知识库选择

**查询**决定了在您的知识库中要搜索的内容。在对话流应用中使用 `sys.query` 进行用户输入，或使用工作流中的任何文本变量。查询限制为 200 个字符。

选择一个或多个**知识库**进行搜索。每个知识库包含您上传到 Dify 的索引文档。可以使用不同的策略同时搜索多个知识库。

### 检索策略

选择如何搜索您的内容：

<Tabs>
  <Tab title="语义检索">
    使用向量嵌入来根据含义查找概念上相似的内容。适用于自然语言查询和使用不同术语的相关概念。
  </Tab>
  
  <Tab title="关键词检索">
    传统的全文检索用于精确的词匹配。对于特定术语、代码或名称，速度更快且更可预测。
  </Tab>
  
  <Tab title="混合检索">
    结合语义和关键词方法。结果使用专门的模型重新排序以提高相关性。
  </Tab>
</Tabs>

## 高级设置

<Frame caption="高级检索配置选项">
  <img src="https://assets-docs.dify.ai/2025/03/fbd43d558f83b355a1b18ac26a253b84.png" alt="Knowledge retrieval configuration interface" />
</Frame>

### 检索参数

**Top K** 控制要检索的文档分段数量。开始时选择 3-5 个分段以获得集中结果，或选择 10-15 个分段以获得全面覆盖。

**分数阈值**设置最低相似度分数。较高的阈值（0.7+）确保相关性，较低的阈值（0.5-）包括更多边缘内容。

**重新排序**在初始检索后重新评分结果。启用于混合检索、多个分段，或当精度优先于速度时。

### 元数据筛选

使用文档的元数据（如类型、日期或部门）来筛选结果。上传文档时设置元数据，以便在大型知识库中实现有针对性的搜索。

### 多知识库策略

**N 对 1 召回**使用函数调用分析查询，选择合适的知识库并优化搜索。适用于不同领域的专业知识库。

**多路召回**同时查询所有选定的知识库并合并结果。当信息跨多个来源或需要全面覆盖时使用。

<Frame caption="多知识库检索策略比较">
  <img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/4a3007cda9dfa50ddac3711693725dce.png" alt="Retrieval Mode Comparison" />
</Frame>

## 输出与集成

节点输出包含文本内容和元数据（来源、分数、文档 ID）的检索文档分段数组。此结构化输出保留了引用所需的信息。

### RAG 集成

将知识检索输出连接到 LLM 节点上下文输入以用于 RAG 应用。当使用检索结果作为上下文变量时，Dify 会自动跟踪来源并启用引用。

```text
System: Answer based on the provided context.
Context: {{knowledge_retrieval.result}}
User: {{user_question}}
```

### 速率限制

知识检索操作受限于您的订阅计划的速率限制。系统使用 Redis 通过 60 秒滑动窗口跟踪请求。当超过限额时，返回 `RateLimitExceeded` 错误。

### 性能考量

检索质量取决于索引实践。较小的分段（200-500 标记）实现精确检索，较大的分段（800-1500 标记）保持上下文。知识库有速率限制 - 节点自动处理节流并缓存相同的查询。
```